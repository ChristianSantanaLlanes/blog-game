---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';

interface Post {
    title: string;
    description: string;
    date: Date;
    image?: ImageMetadata;
    slug: string;
    type: string;
    badge?: string;
}

interface Props {
    mainPost: Post;
    sidePosts: Post[];
}

const { mainPost, sidePosts } = Astro.props;
---

<section class="hero-grid">
    <div class="main-post">
        <div class="image-wrapper" transition:name={`image-/${mainPost.type}/${mainPost.slug}`}>
            {mainPost.image && <Image src={mainPost.image} alt={mainPost.title} loading="eager" />}
            <div class="overlay"></div>
        </div>
        <div class="content">
            <span class="badge main-badge">{mainPost.badge}</span>
            <h2 transition:name={`title-/${mainPost.type}/${mainPost.slug}`}>
                <a href={`/${mainPost.type}/${mainPost.slug}`}>{mainPost.title}</a>
            </h2>
            <p>{mainPost.description}</p>
        </div>
    </div>

    <div class="side-posts">
        {sidePosts.map(post => (
            <article class="side-post">
                <div class="image-wrapper" transition:name={`image-/${post.type}/${post.slug}`}>
                    {post.image && <Image src={post.image} alt={post.title} loading="eager" />}
                    <div class="overlay"></div>
                </div>
                <div class="content">
                    <span class="badge">{post.badge}</span>
                    <h3 transition:name={`title-/${post.type}/${post.slug}`}>
                        <a href={`/${post.type}/${post.slug}`}>{post.title}</a>
                    </h3>
                </div>
            </article>
        ))}
    </div>
</section>

<style>
    .hero-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1.5rem;
        margin-bottom: 4rem;
        height: auto;
    }

    @media (min-width: 768px) {
        .hero-grid {
            grid-template-columns: 2fr 1fr;
            height: 500px;
        }
    }

    .image-wrapper {
        position: absolute;
        inset: 0;
        z-index: 1;
    }

    .image-wrapper img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
    }

    .overlay {
        position: absolute;
        inset: 0;
        background: linear-gradient(to top, rgba(10,10,15, 0.95), rgba(10,10,15, 0.2));
        z-index: 2;
    }

    .main-post, .side-post {
        position: relative;
        border-radius: 12px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
        padding: 2rem;
        border: 1px solid #333;
    }

    .main-post:hover .image-wrapper img, .side-post:hover .image-wrapper img {
        transform: scale(1.05);
    }

    .main-post {
        height: 400px;
    }
    
    @media (min-width: 768px) {
        .main-post {
            height: 100%;
        }
    }

    .side-posts {
        display: grid;
        grid-template-rows: 1fr 1fr;
        gap: 1.5rem;
    }
    
    .side-post {
        padding: 1.5rem;
    }

    .content {
        position: relative;
        z-index: 10;
        pointer-events: none; /* Let clicks pass to links */
    }
    
    .content a {
        pointer-events: all;
    }

    .badge {
        display: inline-block;
        background: var(--color-primary);
        color: #000;
        padding: 4px 10px;
        font-weight: 700;
        text-transform: uppercase;
        font-size: 0.8rem;
        border-radius: 4px;
        margin-bottom: 0.8rem;
    }

    h2 {
        font-size: 2rem;
        line-height: 1.1;
        margin-bottom: 0.8rem;
        text-shadow: 0 4px 4px rgba(0,0,0,0.5);
    }
    
    h3 {
        font-size: 1.2rem;
        line-height: 1.2;
        margin-bottom: 0;
        text-shadow: 0 4px 4px rgba(0,0,0,0.5);
    }

    h2 a, h3 a {
        color: #fff;
        text-decoration: none;
        transition: color 0.2s;
    }
    
    h2 a:hover, h3 a:hover {
        color: var(--color-primary);
    }

    p {
        color: #ccc;
        font-size: 1.1rem;
        max-width: 90%;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>
